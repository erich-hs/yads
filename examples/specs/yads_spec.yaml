name: "warehouse.orders.customer_orders"
version: "2.1.0"
description: "Represents a single customer order, including line items and shipping details."

options:
  if_not_exists: false
  or_replace: false

properties:
  partitioned_by:
    - column: "order_date"
    - column: "created_at"
      transform: "month"
  location: "/warehouse/orders/customer_orders"
  table_type: "iceberg"
  format: "parquet"
  write_compression: "snappy"

metadata:
  owner: "sales-engineering"
  retention_days: 90
  granularity: "One order per customer"

columns:
  - name: "order_id"
    type: "uuid"
    description: "The unique identifier for the order (PK)."
    constraints:
      not_null: true
      primary_key:
        name: "orders_pk"

  - name: "customer_id"
    type: "integer"
    description: "The ID of the customer who placed the order."
    constraints:
      not_null: true

  - name: "order_date"
    type: "date"
    description: "The date the order was placed."
    constraints:
      not_null: true

  - name: "order_total"
    type: "decimal"
    params:
      precision: 10
      scale: 2
    description: "Total monetary value of the order."
    constraints:
      not_null: true
      default: 0.5

  - name: "shipping_address"
    type: "string"
    params:
      length: 255
    description: "The full shipping address."

  - name: "line_items"
    type: "array"
    element:
      type: "struct"
      fields:
        - name: "product_id"
          type: "integer"
          constraints:
            not_null: true
        - name: "quantity"
          type: "integer"
          constraints:
            not_null: true
        - name: "price"
          type: "decimal"
          params:
            precision: 8
            scale: 2
          constraints:
            not_null: true
    description: "A list of products included in the order."

  - name: "tags"
    type: "array"
    element:
      type: "string"
    description: "A list of tags for the order."

  - name: "metadata_tags"
    type: "map"
    key:
      type: "string"
      params:
        length: 50
    value:
      type: "string"
      params:
        length: 255
    description: "A map of metadata tags for the order."

  - name: "created_at"
    type: "timestamp_tz"
    description: "The timestamp when the order record was created in the system."
    constraints:
      not_null: true
    metadata:
      source: "system_generated" 