name: "prod_db.fact_sales.customer_orders_pro"
version: "3.0.0"
description: "A comprehensive example showcasing advanced features of the YADS spec for a customer orders table."

options:
  if_not_exists: true
  is_external: true

storage:
  format: "iceberg"
  location: "/warehouse/sales/customer_orders_pro"
  tbl_properties:
    write.target-file-size-bytes: "536870912"
    read.split.target-size: "268435456"

partitioned_by:
  - column: "order_ts"
    transform: "month"
  - column: "order_status"

metadata:
  owner: "sales-analytics-team"
  retention_days: 365
  granularity: "per-order"

table_constraints:
  - type: "primary_key"
    name: "pk_customer_orders_pro"
    columns: ["order_id"]

columns:
  - name: "order_id"
    type: "uuid"
    description: "Unique identifier for each order."
    constraints:
      not_null: true
  
  - name: "customer_id"
    type: "integer"
    description: "Identifier for the customer who placed the order."
    constraints:
      not_null: true
  
  - name: "order_ts"
    type: "timestamp_tz"
    description: "Timestamp when the order was placed."
    constraints:
      not_null: true
  
  - name: "total_amount"
    type: "decimal"
    params:
      precision: 12
      scale: 2
    description: "The total monetary value of the order."
    constraints:
      not_null: true
      default: 0.00

  - name: "order_status"
    type: "string"
    description: "The current status of the order (e.g., 'shipped', 'pending')."
    constraints:
      default: "pending"

  - name: "product_category"
    type: "string"
    description: "The category of the product."

  - name: "shipping_details"
    type: "struct"
    fields:
      - name: "address"
        type: "string"
        constraints:
          not_null: true
      - name: "city"
        type: "string"
      - name: "postal_code"
        type: "string"
        
  - name: "tags"
    type: "map"
    key:
      type: "string"
    value:
      type: "string"
    description: "Key-value tags associated with the order." 